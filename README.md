# Semáforo Inteligente
##### Autores: Alejandro Lerma y Juan Robles
###### 18/Junio/2020 
#
#
El proyecto consistió en la realización de un semáforo inteligente el cual actúa dependiendo de que tan saturados están los carriles y darle prioridad a los que tiene más autos, está basado en el cruce entre la Avenida Universidad y la Avenida de las Américas. Lo característico de este cruce es que no se puede dar vuelta a la izquierda por lo que solo se avanza en línea recta o a la derecha y los carriles que están de frente funcionan de la misma manera.

Los dispositivos que utilizamos fueron: un PIC18F4550 y cuatro PIC16F877A, los cuales están comunicados por I2C siendo el PIC18F4550 el maestro y los PIC16F877A los esclavos; 4 pantallas LCD, las cuales son controladas cada una por un PIC16F877A; 13 leds, de estos son 4 rojos, 4 amarillos y 4 verdes para los semáforos y 1 azul para control; 9 push buttons, de los cuales 8 son usados como sensores y 1 para para hacer una interrupción a un pic; un potenciómetro para utilizar en lugar de un sensor de humedad; y 2 resistencias de 2kΩ necesarias para la comunicación I2C. Cabe destacar que no se utilizaron resistencias para los leds debido a que en la simulación no son necesarias para su funcionamiento.

Para la selección que carriles requieren más prioridad se utilizan un par de sensores (en simulación se hace con push button y en físico con leds infrarrojos y fototransistores) ubicados antes de llegar al cruce los cuales si son obstruidos se manda la señal al microcontrolador y ya él procesa los proporcionado por los 8 sensores para así mandar la secuencia que deben seguir los semáforos para vaciar el tráfico.

Se utilizó la comunicación I2C debido a que el debíamos de comunicarnos con muchos microcontroladores y el uso del puerto paralelo no era viable porque sería muchos buses de información por lo que con dos cables era lo mejor. Debido a que utilizamos un LCD por carril y este debía ser controlado por un pic, aparte de que estos debían de estar sincronizados para mostrar la misma información. La forma de realizar la comunicación sin interrumpir la secuencia del semáforo fue llamando a la función que realizaba al protocolo I2C en lugar de algunos delay, por lo que gracias a esto las pantallas permanecían actualizadas sin verse afectado el tráfico. Básicamente los programas de los esclavos son iguales las diferencias que presentan es la dirección de cada uno para su identificación en el I2C y que el Esclavo 1 realiza otra tarea descrita más abajo.

Los LCD son utilizados para dar información a los conductores las cuales son 3 instrucciones, una dice “Modere velocidad”, “Cruce obstruido” y “Calle Mojada MAX 25 km/hr”. La primera mostrada cuando no hay nada inusual en el tráfico; la segunda ocurre cuando se oprime el push button que activa una interrupción en uno de los esclavos el cual manda una señal al Maestro para que este les diga a los esclavos poner el mensaje en las pantallas; y la tercera cuando el Maestro detecta por medio del sensor de humedad que la carretera está mojada.

La interrupción de cruce obstruido se implementó en el Esclavo 1 debido a que el Maestro tiene muchas tareas que hacer y los esclavos solamente es recibir que poner en los LCD. Está señal se transmitió al Maestro por otro bus debido a que es más rápido que la comunicación I2C y así poder darle más prioridad. La interrupción de cruce obstruido, además de mandar la señal al Maestro, enciende un led azul como forma de control visual de que se mandó la señal correctamente.
Para el sensor de humedad se utilizó el convertidor análogo-digital que tiene el PIC18F4550, el cual se utilizó la división a 8 bits y utilizamos el 60% de humedad (153 en digital, 3 volts) para mandar la instrucción de la calle mojada.
